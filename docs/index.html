<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Matching Game</title>
    <meta name="description" content="">
    <link rel="stylesheet prefetch" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="stylesheet prefetch" href="https://fonts.googleapis.com/css?family=Coda">
    <link rel="stylesheet" href="css/app.css">
</head>
<style>
html {
    box-sizing: border-box;
}

*,
*::before,
*::after {
    box-sizing: inherit;
}

html,
body {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
}

body {
    background: #ffffff url('../img/geometry2.png'); /* Background pattern from Subtle Patterns */
    font-family: 'Coda', cursive;
}

.container {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}

h1 {
    font-family: 'Open Sans', sans-serif;
    font-weight: 300;
}

/*
 * Styles for the deck of cards
 */

.deck {
    width: 660px;
    min-height: 680px;
    background: linear-gradient(160deg, #02ccba 0%, #aa7ecd 100%);
    padding: 32px;
    border-radius: 10px;
    box-shadow: 12px 15px 20px 0 rgba(46, 61, 73, 0.5);
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    margin: 0 0 3em;
}

.deck .card {
    height: 125px;
    width: 125px;
    background: #2e3d49;
    font-size: 0;
    color: #ffffff;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 5px 2px 20px 0 rgba(46, 61, 73, 0.5);
}

.deck .card.open {
    transform: rotateY(0);
    background: #02b3e4;
    cursor: default;
}

.deck .card.show {
    font-size: 33px;
}

.deck .card.match {
    cursor: default;
    background: #02ccba;
    font-size: 33px;
}

/*
 * Styles for the Score Panel
 */

.score-panel {
    text-align: left;
    width: 345px;
    margin-bottom: 10px;
}

.score-panel .stars {
    margin: 0;
    padding: 0;
    display: inline-block;
    margin: 0 5px 0 0;
}

.score-panel .stars li {
    list-style: none;
    display: inline-block;
}

.score-panel .restart {
    float: right;
    cursor: pointer;
}

/*
 * Styles for Modal
 */

.modal {
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,.4);
}

.modal-content{
    position: absolute;
    position: 50%;
    width: 200px;
    height: 100px;
}</style>
<body>
    <div class="modal">
        <div class="container">
            <header>
                <h1>Matching Game</h1>
            </header>

            <section class="score-panel">
                <ul class="stars">
                    <li><i class="fa fa-star"></i></li>
                    <li><i class="fa fa-star"></i></li>
                    <li><i class="fa fa-star"></i></li>
                </ul>

                <span class="moves">0</span> Moves

                <div class="restart">
                    <i class="fa fa-repeat"></i>
                </div>
            </section>

            <ul class="deck">
                <li class="card">
                    <i class="fa fa-diamond"></i>
                </li>
                <li class="card">
                    <i class="fa fa-paper-plane-o"></i>
                </li>
                <li class="card">
                    <i class="fa fa-anchor"></i>
                </li>
                <li class="card">
                    <i class="fa fa-bolt"></i>
                </li>
                <li class="card">
                    <i class="fa fa-cube"></i>
                </li>
                <li class="card">
                    <i class="fa fa-anchor"></i>
                </li>
                <li class="card">
                    <i class="fa fa-leaf"></i>
                </li>
                <li class="card">
                    <i class="fa fa-bicycle"></i>
                </li>
                <li class="card">
                    <i class="fa fa-diamond"></i>
                </li>
                <li class="card">
                    <i class="fa fa-bomb"></i>
                </li>
                <li class="card">
                    <i class="fa fa-leaf"></i>
                </li>
                <li class="card">
                    <i class="fa fa-bomb"></i>
                </li>
                <li class="card">
                    <i class="fa fa-bolt"></i>
                </li>
                <li class="card">
                    <i class="fa fa-bicycle"></i>
                </li>
                <li class="card">
                    <i class="fa fa-paper-plane-o"></i>
                </li>
                <li class="card">
                    <i class="fa fa-cube"></i>
                </li>
            </ul>
        </div>
    </div>

    <script>
    /*
 * Create a list that holds all of your cards
 */


/*
 * Display the cards on the page
 *   - shuffle the list of cards using the provided "shuffle" method below
 *   - loop through each card and create its HTML
 *   - add each card's HTML to the page
 */

// Shuffle function from http://stackoverflow.com/a/2450976
function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex;

    while (currentIndex !== 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    }

    return array;
}


/*
 * set up the event listener for a card. If a card is clicked:
 *  - display the card's symbol (put this functionality in another function that you call from this one)
 *  - add the card to a *list* of "open" cards (put this functionality in another function that you call from this one)
 *  - if the list already has another card, check to see if the two cards match
 *    + if the cards do match, lock the cards in the open position (put this functionality in another function that you call from this one)
 *    + if the cards do not match, remove the cards from the list and hide the card's symbol (put this functionality in another function that you call from this one)
 *    + increment the move counter and display it on the page (put this functionality in another function that you call from this one)
 *    + if all cards have matched, display a message with the final score (put this functionality in another function that you call from this one)
 */

let cardList = document.querySelectorAll('li.card');
let openCardList = [];
let moves = 0; //move counter


/**Event Listeners */

Array.from(cardList).forEach(function(element){
    element.addEventListener('click', onClick)
});

document.querySelector('.restart').addEventListener('click', function(){
    boardShuffle()
});

//Running boardShuffle so that the page does proper initalizing
boardShuffle();


/**Functions */

//main functionality function
function onClick(trigger){
    let card = trigger.currentTarget;

    //this check is supposed to prevent selecting more than two cards
    if (pushCard(card)){
        toggleDisplay(card);

        //if openCardList.length > 1
        if (openCardList.length == 2)
        {
            //Move counter should only be incremented when a cards are compared
            moveCount();
            //this checks the value stored in the card, yes the path ends up being long
            if (openCardList[0].firstElementChild.classList[1] == openCardList[1].firstElementChild.classList[1]){
                cardMatch(openCardList);
            }
            else {
                //if there is no match, then run that after a short pause
                setTimeout(function(){  //have to pass our real function call through an anonymous one
                    cardNoMatch(openCardList);
                }, 750); //pause is set to 750 miliseconds here
            }
        }
        
    }

    
    gameOver();
}

// display the card's symbol
function toggleDisplay(card){
    //using toggle so we can call this whenever we have to flip a card
    card.classList.toggle('open');
    card.classList.toggle('show');
}

// add the card to a *list* of "open" cards 
// returns TRUE if a card was added, otherwise FALSE
function pushCard(card){
    // we only want to add the card if there is only one other card selected
    if (openCardList.length < 2 && card !== openCardList[0]){
        openCardList.push(card);
        return true;    
    }
    else return false;
}


// if the cards do match, lock the cards in the open position    
function cardMatch(cards){
    //switch the cards to the matching style
    cards.forEach(function(card){
        card.classList.add('match');
    })
    //loop through the list and remove each value
    for ( let i = cards.length; i > 0; i--){
        cards.pop();
    }
}
    
    // must be called after the open function

//if the cards do not match, remove the cards from the list and hide the card's symbol
function cardNoMatch(cards){
    cards.forEach(function(card){
        toggleDisplay(card);
    })
    //loop through the list and remove each value
    for ( let i = cards.length; i > 0; i--){
        cards.pop();
    }
}

//Increment move counter
function moveCount(){
    moves += 1;
    //get the element storing the move value from document
    let el = document.querySelector('.moves');
    el.innerText = moves; //and update it

    //rating logic
    let stars = document.querySelector('.stars');
    if (moves < 13){
        //3 stars
        stars.children[0].style.color = 'gold';
        stars.children[1].style.color = 'gold';
        stars.children[2].style.color = 'gold';
    }
    else if (moves < 16){
        //2 stars
        stars.children[0].style.color = 'gold';
        stars.children[1].style.color = 'gold';
        stars.children[2].style.color = 'black';
    }
    else if (moves < 20){
        //1 star
        stars.children[0].style.color = 'gold';
        stars.children[1].style.color = 'black';
        stars.children[2].style.color = 'black';
    }
    else{
        //no stars
        stars.children[0].style.color = 'black';
        stars.children[1].style.color = 'black';
        stars.children[2].style.color = 'black';
        
    }
}

//Checks to see if the game is over
function gameOver(){
    //Set this bool to false if any card does not match
    let allMatch = true;
    cardList.forEach(card => {
        if (!(card.classList.contains('match'))){
            allMatch = false;
        }
    });

    if (allMatch){
        //display win
        setTimeout(function(){
            alert(`You won after ${moves} moves!`);
        }, 250);
    }
}

//Shuffles our array of cards and updates the document
function boardShuffle() {
    //hide all the cards
    cardList.forEach(function(element){
        element.classList.remove('show');
        element.classList.remove('open');
        element.classList.remove('match');
    })

    //make a simple array of the card values (the symbols)
    let sCards = [];
    
    cardList.forEach(function(card){
        sCards.push(card.firstElementChild.classList[1]);
    })
    sCards = shuffle(sCards);

    //get a current list of all the elements on the page
    let dCardList = document.querySelectorAll('li.card');

    //takes each element and changes the class to the value in the shuffled list
    for ( let i = 0; i < cardList.length; i++){
        let oldClass = dCardList[i].firstElementChild.classList[1];
        let newClass = sCards[i];
        dCardList[i].firstElementChild.classList.remove(oldClass);
        dCardList[i].firstElementChild.classList.add(newClass);
    }

    //make sure our list matches the new one
    cardList = document.querySelectorAll('li.card');
    
    //reset the move counter
    moves = -1;
    moveCount();
}</script>
</body>
</html>
